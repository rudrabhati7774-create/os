<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Love Space Shooter 3D</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  touch-action:none;
  font-family:Arial;
}

#shootBtn{
  position:fixed;
  bottom:40px;
  right:30px;
  width:70px;
  height:70px;
  border-radius:50%;
  border:none;
  background:#ff1493;
  color:white;
  font-size:22px;
  z-index:10;
}

#joystick{
  position:fixed;
  bottom:30px;
  left:30px;
  width:120px;
  height:120px;
  border-radius:50%;
  background:rgba(255,255,255,0.1);
  z-index:10;
}

#stick{
  position:absolute;
  width:60px;
  height:60px;
  background:white;
  border-radius:50%;
  top:30px;
  left:30px;
}

#score{
  position:fixed;
  top:20px;
  left:20px;
  color:white;
  font-size:18px;
  z-index:10;
}

#gameOver{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  color:white;
  font-size:30px;
  display:none;
  z-index:20;
}
</style>
</head>
<body>

<div id="score">Hearts: 0 | Lives: 3</div>
<div id="gameOver"></div>
<div id="joystick"><div id="stick"></div></div>
<button id="shootBtn">ðŸ’˜</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>

let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

camera.position.z = 8;

const loader = new THREE.TextureLoader();

// ðŸš€ Rocket
const rocketTexture = loader.load("/assets/icons/rocket.png");
const rocketGeo = new THREE.PlaneGeometry(1.5,2);
const rocketMat = new THREE.MeshBasicMaterial({map:rocketTexture,transparent:true});
const rocket = new THREE.Mesh(rocketGeo,rocketMat);
rocket.position.y = -4;
scene.add(rocket);

let bullets=[];
let enemyBullets=[];
let hearts=[];
let killCount=0;
let lives=3;
let gameRunning=true;

const lanes=[-2,0,2];

const scoreUI=document.getElementById("score");
const gameOverUI=document.getElementById("gameOver");

// SHOOT
document.getElementById("shootBtn").onclick=()=>{
  if(!gameRunning) return;

  const geo=new THREE.CylinderGeometry(0.1,0.1,1);
  const mat=new THREE.MeshBasicMaterial({color:0xffff00});
  const bullet=new THREE.Mesh(geo,mat);
  bullet.position.set(rocket.position.x,rocket.position.y+1,0);
  bullets.push(bullet);
  scene.add(bullet);
};

// CREATE ENEMY HEART
function createHeart(){
  if(!gameRunning) return;
  if(hearts.length>=2) return;

  const texture = loader.load("/assets/icons/heart.png");
  const geo = new THREE.PlaneGeometry(0.9,0.9);
  const mat = new THREE.MeshBasicMaterial({map:texture,transparent:true});
  const heart = new THREE.Mesh(geo,mat);

  heart.position.x = lanes[Math.floor(Math.random()*lanes.length)];
  heart.position.y = 7;
  heart.userData.speed = 0.05;

  scene.add(heart);
  hearts.push(heart);

  // Enemy shooting
  heart.userData.shootInterval = setInterval(()=>{
    if(!hearts.includes(heart) || !gameRunning) return;

    const bGeo=new THREE.SphereGeometry(0.2,16,16);
    const bMat=new THREE.MeshBasicMaterial({color:0xff0000});
    const eBullet=new THREE.Mesh(bGeo,bMat);
    eBullet.position.set(heart.position.x,heart.position.y,0);
    enemyBullets.push(eBullet);
    scene.add(eBullet);

  },2000);
}

setInterval(createHeart,1500);

// JOYSTICK
const joystick=document.getElementById("joystick");
const stick=document.getElementById("stick");
let moveX=0;

joystick.addEventListener("touchmove",(e)=>{
  const rect=joystick.getBoundingClientRect();
  const touch=e.touches[0];
  let x=touch.clientX-rect.left-60;

  if(x<-40)x=-40;
  if(x>40)x=40;

  stick.style.left=(x+60-30)+"px";
  moveX=x/20;
});

joystick.addEventListener("touchend",()=>{
  stick.style.left="30px";
  moveX=0;
});

// GAME LOOP
function animate(){
  requestAnimationFrame(animate);

  if(!gameRunning){
    renderer.render(scene,camera);
    return;
  }

  rocket.position.x += (moveX-rocket.position.x)*0.1;

  // Player bullets
  bullets.forEach((b,i)=>{
    b.position.y+=0.3;
    if(b.position.y>6){
      scene.remove(b);
      bullets.splice(i,1);
    }
  });

  // Enemy bullets
  enemyBullets.forEach((b,i)=>{
    b.position.y-=0.15;

    if(b.position.distanceTo(rocket.position)<0.8){
      scene.remove(b);
      enemyBullets.splice(i,1);
      lives--;
      updateUI();

      if(lives<=0){
        gameOver(false);
      }
    }

    if(b.position.y<-6){
      scene.remove(b);
      enemyBullets.splice(i,1);
    }
  });

  // Hearts
  hearts.forEach((h,i)=>{
    h.position.y-=h.userData.speed;
    h.rotation.z+=0.02;

    if(h.position.y<-6){
      scene.remove(h);
      hearts.splice(i,1);
    }

    bullets.forEach((b,bi)=>{
      if(b.position.distanceTo(h.position)<0.7){
        scene.remove(h);
        scene.remove(b);
        clearInterval(h.userData.shootInterval);

        hearts.splice(i,1);
        bullets.splice(bi,1);

        killCount++;
        rocket.position.y+=0.25;
        updateUI();

        if(killCount>=15){
          gameOver(true);
        }
      }
    });
  });

  renderer.render(scene,camera);
}

animate();

function updateUI(){
  scoreUI.innerText="Hearts: "+killCount+" | Lives: "+lives;
}

function gameOver(win){
  gameRunning=false;
  gameOverUI.style.display="block";
  gameOverUI.innerText = win ? "You Win ðŸ’–ðŸš€" : "Game Over ðŸ’”";
}

</script>
</body>
</html>
